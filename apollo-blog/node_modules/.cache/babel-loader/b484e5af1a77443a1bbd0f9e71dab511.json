{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nimport { BottomToolbar } from '@react-page/ui';\nimport debounce from 'lodash.debounce';\nimport React, { Fragment, useCallback, useEffect, useMemo, useState } from 'react';\nimport { AutoFields as AutoFieldsOrg, AutoForm as AutoFormOrg } from 'uniforms-material';\nimport makeUniformsSchema from '../utils/makeUniformsSchema'; // see https://github.com/vazco/uniforms/issues/617\n// tslint:disable-next-line:no-any\n\nvar AutoForm = AutoFormOrg; // tslint:disable-next-line:no-any\n\nvar AutoFields = AutoFieldsOrg;\nvar defaultControlsLayout = {\n  columnCount: 2\n};\n\nvar getDefaultValue = function (bridge) {\n  return bridge.getSubfields(null).reduce(function (acc, fieldName) {\n    var _a;\n\n    return __assign(__assign({}, acc), (_a = {}, _a[fieldName] = bridge.getInitialValue(fieldName), _a));\n  }, {});\n};\n\nfunction Controls(props) {\n  var saveDebounced = useCallback(debounce(function (m) {\n    return props.onChange(m);\n  }, 1000), [props.onChange]);\n\n  var _a = __read(useState(), 2),\n      preview = _a[0],\n      setPreview = _a[1];\n\n  var onSubmit = useCallback(function (model) {\n    setPreview(model);\n    saveDebounced(model);\n  }, []);\n  var focused = props.focused,\n      state = props.state,\n      schema = props.schema,\n      _b = props.controlsLayout,\n      controlsLayout = _b === void 0 ? defaultControlsLayout : _b,\n      Renderer = props.Renderer,\n      remove = props.remove;\n  var bridge = useMemo(function () {\n    return makeUniformsSchema(schema);\n  }, [schema]);\n  useEffect(function () {\n    var _a;\n\n    onSubmit(__assign(__assign({}, getDefaultValue(bridge)), (_a = preview !== null && preview !== void 0 ? preview : state, _a !== null && _a !== void 0 ? _a : {})));\n  }, [bridge]);\n  return React.createElement(React.Fragment, null, React.createElement(Renderer, __assign({}, props, {\n    state: preview !== null && preview !== void 0 ? preview : state\n  })), React.createElement(BottomToolbar, __assign({\n    open: focused,\n    title: props.text,\n    onDelete: remove,\n    icon: props.IconComponent\n  }, props), React.createElement(\"div\", {\n    style: {\n      marginBottom: 24,\n      maxHeight: '50vh',\n      overflow: 'auto'\n    }\n  }, React.createElement(AutoForm, {\n    model: preview || state,\n    autosave: true,\n    schema: bridge,\n    onSubmit: onSubmit\n  }, React.createElement(\"div\", {\n    style: {\n      columnCount: controlsLayout.columnCount || 2,\n      columnRule: '1px solid #E0E0E0',\n      columnGap: 48\n    }\n  }, React.createElement(AutoFields, {\n    element: Fragment\n  }))))));\n}\n\nexport default Controls;","map":{"version":3,"sources":["../../src/Controls/index.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { BottomToolbar } from '@react-page/ui';\nimport debounce from 'lodash.debounce';\nimport React, { Fragment, useCallback, useEffect, useMemo, useState } from 'react';\nimport { AutoFields as AutoFieldsOrg, AutoForm as AutoFormOrg } from 'uniforms-material';\nimport makeUniformsSchema from '../utils/makeUniformsSchema';\n// see https://github.com/vazco/uniforms/issues/617\n// tslint:disable-next-line:no-any\nvar AutoForm = AutoFormOrg;\n// tslint:disable-next-line:no-any\nvar AutoFields = AutoFieldsOrg;\nvar defaultControlsLayout = {\n    columnCount: 2,\n};\nvar getDefaultValue = function (bridge) {\n    return bridge.getSubfields(null).reduce(function (acc, fieldName) {\n        var _a;\n        return (__assign(__assign({}, acc), (_a = {}, _a[fieldName] = bridge.getInitialValue(fieldName), _a)));\n    }, {});\n};\nfunction Controls(props) {\n    var saveDebounced = useCallback(debounce(function (m) { return props.onChange(m); }, 1000), [props.onChange]);\n    var _a = __read(useState(), 2), preview = _a[0], setPreview = _a[1];\n    var onSubmit = useCallback(function (model) {\n        setPreview(model);\n        saveDebounced(model);\n    }, []);\n    var focused = props.focused, state = props.state, schema = props.schema, _b = props.controlsLayout, controlsLayout = _b === void 0 ? defaultControlsLayout : _b, Renderer = props.Renderer, remove = props.remove;\n    var bridge = useMemo(function () { return makeUniformsSchema(schema); }, [schema]);\n    useEffect(function () {\n        var _a;\n        onSubmit(__assign(__assign({}, getDefaultValue(bridge)), (_a = (preview !== null && preview !== void 0 ? preview : state), (_a !== null && _a !== void 0 ? _a : {}))));\n    }, [bridge]);\n    return (React.createElement(React.Fragment, null,\n        React.createElement(Renderer, __assign({}, props, { state: (preview !== null && preview !== void 0 ? preview : state) })),\n        React.createElement(BottomToolbar, __assign({ open: focused, title: props.text, onDelete: remove, icon: props.IconComponent }, props),\n            React.createElement(\"div\", { style: { marginBottom: 24, maxHeight: '50vh', overflow: 'auto' } },\n                React.createElement(AutoForm, { model: preview || state, autosave: true, schema: bridge, onSubmit: onSubmit },\n                    React.createElement(\"div\", { style: {\n                            columnCount: controlsLayout.columnCount || 2,\n                            columnRule: '1px solid #E0E0E0',\n                            columnGap: 48,\n                        } },\n                        React.createElement(AutoFields, { element: Fragment })))))));\n}\nexport default Controls;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}