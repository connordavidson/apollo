{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/*\n * This file is part of ORY Editor.\n *\n * ORY Editor is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * ORY Editor is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with ORY Editor.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @license LGPL-3.0\n * @copyright 2016-2018 Aeneas Rekkas\n * @author Aeneas Rekkas <aeneas+oss@aeneas.io>\n *\n */\n\n\nimport throttle from 'lodash.throttle';\nimport * as React from 'react';\nimport { createStructuredSelector } from 'reselect';\nimport { createFallbackCell } from '../../../actions/cell';\nimport scollIntoViewWithOffset from '../../../components/Cell/utils/scollIntoViewWithOffset';\nimport { connect } from '../../../reduxConnect';\nimport { purifiedEditable } from '../../../selector/editable';\nimport { ContentPlugin, LayoutPlugin } from '../../../service/plugin/classes';\nimport Cell from '../../Cell';\nimport dimensions from '../../Dimensions';\n\nfunction isElementInViewport(el) {\n  var rect = el.getBoundingClientRect();\n  return rect.top >= 0 && rect.left >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)\n  /*or $(window).height() */\n  && rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n  /*or $(window).width() */\n  ;\n}\n\nvar Inner =\n/** @class */\nfunction (_super) {\n  __extends(Inner, _super);\n\n  function Inner() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.ref = React.createRef();\n    _this.firstElementInViewport = null;\n    _this.onScroll = throttle(function () {\n      if (_this.ref.current) {\n        var firstInViewport = Array.prototype.find.call(_this.ref.current.getElementsByClassName('ory-cell'), function (cell) {\n          return isElementInViewport(cell);\n        });\n\n        if (firstInViewport) {\n          _this.firstElementInViewport = {\n            el: firstInViewport,\n            topOffset: firstInViewport.getBoundingClientRect().top\n          };\n        } else {\n          _this.firstElementInViewport = null;\n        }\n      }\n    }, 600);\n\n    _this.createFallbackCell = function () {\n      var _a = _this.props,\n          node = _a.node,\n          defaultPlugin = _a.defaultPlugin,\n          id = _a.id;\n\n      if (!node) {\n        return;\n      }\n\n      var _b = node.cells,\n          cells = _b === void 0 ? [] : _b;\n\n      if (cells.length === 0) {\n        // FIXME: one more reason to unify layout and content plugins...\n        if (defaultPlugin.createInitialChildren) {\n          _this.props.createFallbackCell(new LayoutPlugin(defaultPlugin), id);\n        } else {\n          _this.props.createFallbackCell(new ContentPlugin(defaultPlugin), id);\n        }\n      }\n    };\n\n    return _this;\n  }\n\n  Inner.prototype.componentDidMount = function () {\n    this.createFallbackCell();\n    window.addEventListener('scroll', this.onScroll);\n  };\n\n  Inner.prototype.componentDidUpdate = function (oldProps) {\n    this.createFallbackCell();\n\n    if (oldProps.displayMode !== this.props.displayMode) {\n      if (this.firstElementInViewport) {\n        var _a = this.firstElementInViewport,\n            el_1 = _a.el,\n            topOffset_1 = _a.topOffset;\n        setTimeout(function () {\n          scollIntoViewWithOffset(el_1, topOffset_1, 'auto');\n        }, 0);\n      }\n    }\n  };\n\n  Inner.prototype.componentWillUnmount = function () {\n    window.removeEventListener('scroll', this.onScroll);\n  };\n\n  Inner.prototype.render = function () {\n    var _a = this.props,\n        id = _a.id,\n        containerWidth = _a.containerWidth,\n        containerHeight = _a.containerHeight,\n        node = _a.node;\n\n    if (!node) {\n      return null;\n    }\n\n    var _b = node.cells,\n        cells = _b === void 0 ? [] : _b;\n    return React.createElement(\"div\", {\n      ref: this.ref,\n      className: \"ory-editable\"\n    }, cells.map(function (c) {\n      return React.createElement(Cell, {\n        rowWidth: containerWidth,\n        rowHeight: containerHeight,\n        editable: id,\n        ancestors: [],\n        key: c,\n        id: c\n      });\n    }));\n  };\n\n  return Inner;\n}(React.PureComponent);\n\nexport var displayMode = function (_a) {\n  var mode = _a.reactPage.display.mode;\n  return mode;\n};\nvar mapStateToProps = createStructuredSelector({\n  node: purifiedEditable,\n  displayMode: displayMode\n});\nvar mapDispatchToProps = {\n  createFallbackCell: createFallbackCell\n};\nexport default dimensions()(connect(mapStateToProps, mapDispatchToProps)(Inner));","map":{"version":3,"sources":["../../../../src/components/Editable/Inner/index.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;AAqBA,OAAO,QAAP,MAAqB,iBAArB;AACA,OAAO,KAAK,KAAZ,MAAuB,OAAvB;AACA,SAAS,wBAAT,QAAyC,UAAzC;AACA,SAAS,kBAAT,QAAmC,uBAAnC;AACA,OAAO,uBAAP,MAAoC,wDAApC;AACA,SAAS,OAAT,QAAwB,uBAAxB;AAEA,SAAS,gBAAT,QAAiC,4BAAjC;AACA,SACE,aADF,EAGE,YAHF,QAKO,iCALP;AAOA,OAAO,IAAP,MAAiB,YAAjB;AACA,OAAO,UAAP,MAAuB,kBAAvB;;AACA,SAAS,mBAAT,CAA6B,EAA7B,EAA+C;AAC7C,MAAM,IAAI,GAAG,EAAE,CAAC,qBAAH,EAAb;AAEA,SACE,IAAI,CAAC,GAAL,IAAY,CAAZ,IACA,IAAI,CAAC,IAAL,IAAa,CADb,IAEA,IAAI,CAAC,MAAL,KACG,MAAM,CAAC,WAAP,IACC,QAAQ,CAAC,eAAT,CAAyB,YAF7B;AAE2C;AAJ3C,KAKA,IAAI,CAAC,KAAL,KACG,MAAM,CAAC,UAAP,IACC,QAAQ,CAAC,eAAT,CAAyB,WAF7B;AAE0C;AAR5C;AAUD;;AACD,IAAA,KAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAAoB,EAAA,SAAA,CAAA,KAAA,EAAA,MAAA,CAAA;;AAApB,WAAA,KAAA,GAAA;AAAA,QAAA,KAAA,GAAA,MAAA,KAAA,IAAA,IAAA,MAAA,CAAA,KAAA,CAAA,IAAA,EAAA,SAAA,CAAA,IAAA,IAAA;;AACE,IAAA,KAAA,CAAA,GAAA,GAAM,KAAK,CAAC,SAAN,EAAN;AACA,IAAA,KAAA,CAAA,sBAAA,GAAyB,IAAzB;AAEA,IAAA,KAAA,CAAA,QAAA,GAAW,QAAQ,CAAC,YAAA;AAClB,UAAI,KAAI,CAAC,GAAL,CAAS,OAAb,EAAsB;AACpB,YAAM,eAAe,GAAmB,KAAK,CAAC,SAAN,CAAgB,IAAhB,CAAqB,IAArB,CACtC,KAAI,CAAC,GAAL,CAAS,OAAT,CAAiB,sBAAjB,CAAwC,UAAxC,CADsC,EAEtC,UAAC,IAAD,EAAqB;AAAK,iBAAA,mBAAmB,CAAnB,IAAmB,CAAnB;AAAyB,SAFb,CAAxC;;AAIA,YAAI,eAAJ,EAAqB;AACnB,UAAA,KAAI,CAAC,sBAAL,GAA8B;AAC5B,YAAA,EAAE,EAAE,eADwB;AAE5B,YAAA,SAAS,EAAE,eAAe,CAAC,qBAAhB,GAAwC;AAFvB,WAA9B;AAID,SALD,MAKO;AACL,UAAA,KAAI,CAAC,sBAAL,GAA8B,IAA9B;AACD;AACF;AACF,KAfkB,EAehB,GAfgB,CAAnB;;AAqCA,IAAA,KAAA,CAAA,kBAAA,GAAqB,YAAA;AACb,UAAA,EAAA,GAAA,KAAA,CAAA,KAAA;AAAA,UAAE,IAAA,GAAA,EAAA,CAAA,IAAF;AAAA,UAAQ,aAAA,GAAA,EAAA,CAAA,aAAR;AAAA,UAAuB,EAAA,GAAA,EAAA,CAAA,EAAvB;;AAEN,UAAI,CAAC,IAAL,EAAW;AACT;AACD;;AAEO,UAAA,EAAA,GAAA,IAAA,CAAA,KAAA;AAAA,UAAA,KAAA,GAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,EAAA;;AACR,UAAI,KAAK,CAAC,MAAN,KAAiB,CAArB,EAAwB;AACtB;AACA,YAAK,aAAoC,CAAC,qBAA1C,EAAiE;AAC/D,UAAA,KAAI,CAAC,KAAL,CAAW,kBAAX,CAA8B,IAAI,YAAJ,CAAiB,aAAjB,CAA9B,EAA+D,EAA/D;AACD,SAFD,MAEO;AACL,UAAA,KAAI,CAAC,KAAL,CAAW,kBAAX,CACE,IAAI,aAAJ,CAAkB,aAAlB,CADF,EAEE,EAFF;AAID;AACF;AACF,KAnBD;;;AA4CD;;AAhEC,EAAA,KAAA,CAAA,SAAA,CAAA,iBAAA,GAAA,YAAA;AACE,SAAK,kBAAL;AACA,IAAA,MAAM,CAAC,gBAAP,CAAwB,QAAxB,EAAkC,KAAK,QAAvC;AACD,GAHD;;AAKA,EAAA,KAAA,CAAA,SAAA,CAAA,kBAAA,GAAA,UAAmB,QAAnB,EAAmD;AACjD,SAAK,kBAAL;;AACA,QAAI,QAAQ,CAAC,WAAT,KAAyB,KAAK,KAAL,CAAW,WAAxC,EAAqD;AACnD,UAAI,KAAK,sBAAT,EAAiC;AAC3B,YAAA,EAAA,GAAA,KAAA,sBAAA;AAAA,YAAE,IAAA,GAAA,EAAA,CAAA,EAAF;AAAA,YAAM,WAAA,GAAA,EAAA,CAAA,SAAN;AACJ,QAAA,UAAU,CAAC,YAAA;AACT,UAAA,uBAAuB,CAAC,IAAD,EAAK,WAAL,EAAgB,MAAhB,CAAvB;AACD,SAFS,EAEP,CAFO,CAAV;AAGD;AACF;AACF,GAVD;;AAYA,EAAA,KAAA,CAAA,SAAA,CAAA,oBAAA,GAAA,YAAA;AACE,IAAA,MAAM,CAAC,mBAAP,CAA2B,QAA3B,EAAqC,KAAK,QAA1C;AACD,GAFD;;AAwBA,EAAA,KAAA,CAAA,SAAA,CAAA,MAAA,GAAA,YAAA;AACQ,QAAA,EAAA,GAAA,KAAA,KAAA;AAAA,QAAE,EAAA,GAAA,EAAA,CAAA,EAAF;AAAA,QAAM,cAAA,GAAA,EAAA,CAAA,cAAN;AAAA,QAAsB,eAAA,GAAA,EAAA,CAAA,eAAtB;AAAA,QAAuC,IAAA,GAAA,EAAA,CAAA,IAAvC;;AAEN,QAAI,CAAC,IAAL,EAAW;AACT,aAAO,IAAP;AACD;;AAEO,QAAA,EAAA,GAAA,IAAA,CAAA,KAAA;AAAA,QAAA,KAAA,GAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,EAAA;AACR,WACE,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,MAAA,GAAG,EAAE,KAAK,GAAf;AAAoB,MAAA,SAAS,EAAC;AAA9B,KAAA,EACG,KAAK,CAAC,GAAN,CAAU,UAAC,CAAD,EAAU;AAAK,aACxB,KAAA,CAAA,aAAA,CAAC,IAAD,EAAK;AACH,QAAA,QAAQ,EAAE,cADP;AAEH,QAAA,SAAS,EAAE,eAFR;AAGH,QAAA,QAAQ,EAAE,EAHP;AAIH,QAAA,SAAS,EAAE,EAJR;AAKH,QAAA,GAAG,EAAE,CALF;AAMH,QAAA,EAAE,EAPoB;AACnB,OAAL,CADwB;AASzB,KATA,CADH,CADF;AAcD,GAtBD;;AAuBF,SAAA,KAAA;AAAC,CArFD,CAAoB,KAAK,CAAC,aAA1B,CAAA;;AAuFA,OAAO,IAAM,WAAW,GAAG,UAAC,EAAD,EAIf;MAFG,IAAA,GAAA,EAAA,CAAA,SAAA,CAAA,OAAA,CAAA,I;AAEU,SAAA,IAAA;AAAI,CAJtB;AAMP,IAAM,eAAe,GAAG,wBAAwB,CAAC;AAC/C,EAAA,IAAI,EAAE,gBADyC;AAE/C,EAAA,WAAW,EAAA;AAFoC,CAAD,CAAhD;AAKA,IAAM,kBAAkB,GAAG;AAAE,EAAA,kBAAkB,EAAA;AAApB,CAA3B;AAEA,eAAe,UAAU,GACvB,OAAO,CACL,eADK,EAEL,kBAFK,CAAP,CAGE,KAHF,CADuB,CAAzB","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/*\n * This file is part of ORY Editor.\n *\n * ORY Editor is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * ORY Editor is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with ORY Editor.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @license LGPL-3.0\n * @copyright 2016-2018 Aeneas Rekkas\n * @author Aeneas Rekkas <aeneas+oss@aeneas.io>\n *\n */\nimport throttle from 'lodash.throttle';\nimport * as React from 'react';\nimport { createStructuredSelector } from 'reselect';\nimport { createFallbackCell } from '../../../actions/cell';\nimport scollIntoViewWithOffset from '../../../components/Cell/utils/scollIntoViewWithOffset';\nimport { connect } from '../../../reduxConnect';\nimport { purifiedEditable } from '../../../selector/editable';\nimport { ContentPlugin, LayoutPlugin } from '../../../service/plugin/classes';\nimport Cell from '../../Cell';\nimport dimensions from '../../Dimensions';\nfunction isElementInViewport(el) {\n    var rect = el.getBoundingClientRect();\n    return (rect.top >= 0 &&\n        rect.left >= 0 &&\n        rect.bottom <=\n            (window.innerHeight ||\n                document.documentElement.clientHeight) /*or $(window).height() */ &&\n        rect.right <=\n            (window.innerWidth ||\n                document.documentElement.clientWidth) /*or $(window).width() */);\n}\nvar Inner = /** @class */ (function (_super) {\n    __extends(Inner, _super);\n    function Inner() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.ref = React.createRef();\n        _this.firstElementInViewport = null;\n        _this.onScroll = throttle(function () {\n            if (_this.ref.current) {\n                var firstInViewport = Array.prototype.find.call(_this.ref.current.getElementsByClassName('ory-cell'), function (cell) { return isElementInViewport(cell); });\n                if (firstInViewport) {\n                    _this.firstElementInViewport = {\n                        el: firstInViewport,\n                        topOffset: firstInViewport.getBoundingClientRect().top,\n                    };\n                }\n                else {\n                    _this.firstElementInViewport = null;\n                }\n            }\n        }, 600);\n        _this.createFallbackCell = function () {\n            var _a = _this.props, node = _a.node, defaultPlugin = _a.defaultPlugin, id = _a.id;\n            if (!node) {\n                return;\n            }\n            var _b = node.cells, cells = _b === void 0 ? [] : _b;\n            if (cells.length === 0) {\n                // FIXME: one more reason to unify layout and content plugins...\n                if (defaultPlugin.createInitialChildren) {\n                    _this.props.createFallbackCell(new LayoutPlugin(defaultPlugin), id);\n                }\n                else {\n                    _this.props.createFallbackCell(new ContentPlugin(defaultPlugin), id);\n                }\n            }\n        };\n        return _this;\n    }\n    Inner.prototype.componentDidMount = function () {\n        this.createFallbackCell();\n        window.addEventListener('scroll', this.onScroll);\n    };\n    Inner.prototype.componentDidUpdate = function (oldProps) {\n        this.createFallbackCell();\n        if (oldProps.displayMode !== this.props.displayMode) {\n            if (this.firstElementInViewport) {\n                var _a = this.firstElementInViewport, el_1 = _a.el, topOffset_1 = _a.topOffset;\n                setTimeout(function () {\n                    scollIntoViewWithOffset(el_1, topOffset_1, 'auto');\n                }, 0);\n            }\n        }\n    };\n    Inner.prototype.componentWillUnmount = function () {\n        window.removeEventListener('scroll', this.onScroll);\n    };\n    Inner.prototype.render = function () {\n        var _a = this.props, id = _a.id, containerWidth = _a.containerWidth, containerHeight = _a.containerHeight, node = _a.node;\n        if (!node) {\n            return null;\n        }\n        var _b = node.cells, cells = _b === void 0 ? [] : _b;\n        return (React.createElement(\"div\", { ref: this.ref, className: \"ory-editable\" }, cells.map(function (c) { return (React.createElement(Cell, { rowWidth: containerWidth, rowHeight: containerHeight, editable: id, ancestors: [], key: c, id: c })); })));\n    };\n    return Inner;\n}(React.PureComponent));\nexport var displayMode = function (_a) {\n    var mode = _a.reactPage.display.mode;\n    return mode;\n};\nvar mapStateToProps = createStructuredSelector({\n    node: purifiedEditable,\n    displayMode: displayMode,\n});\nvar mapDispatchToProps = { createFallbackCell: createFallbackCell };\nexport default dimensions()(connect(mapStateToProps, mapDispatchToProps)(Inner));\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}