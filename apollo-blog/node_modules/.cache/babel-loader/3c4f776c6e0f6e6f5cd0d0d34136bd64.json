{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\n\nvar tslib_1 = require(\"tslib\");\n\nvar prop_types_1 = tslib_1.__importDefault(require(\"prop-types\"));\n\nvar react_1 = tslib_1.__importStar(require(\"react\"));\n\nvar cloneDeep_1 = tslib_1.__importDefault(require(\"lodash/cloneDeep\"));\n\nvar get_1 = tslib_1.__importDefault(require(\"lodash/get\"));\n\nvar isFunction_1 = tslib_1.__importDefault(require(\"lodash/isFunction\"));\n\nvar isPlainObject_1 = tslib_1.__importDefault(require(\"lodash/isPlainObject\"));\n\nvar mapValues_1 = tslib_1.__importDefault(require(\"lodash/mapValues\"));\n\nvar omit_1 = tslib_1.__importDefault(require(\"lodash/omit\"));\n\nvar set_1 = tslib_1.__importDefault(require(\"lodash/set\"));\n\nvar randomIds_1 = tslib_1.__importDefault(require(\"./randomIds\"));\n\nvar createSchemaBridge_1 = tslib_1.__importDefault(require(\"./createSchemaBridge\"));\n\nvar changedKeys_1 = tslib_1.__importDefault(require(\"./changedKeys\"));\n\nexports.__childContextTypes = {\n  name: prop_types_1[\"default\"].arrayOf(prop_types_1[\"default\"].string).isRequired,\n  error: prop_types_1[\"default\"].object,\n  model: prop_types_1[\"default\"].object.isRequired,\n  schema: {\n    getError: prop_types_1[\"default\"].func.isRequired,\n    getErrorMessage: prop_types_1[\"default\"].func.isRequired,\n    getErrorMessages: prop_types_1[\"default\"].func.isRequired,\n    getField: prop_types_1[\"default\"].func.isRequired,\n    getInitialValue: prop_types_1[\"default\"].func.isRequired,\n    getProps: prop_types_1[\"default\"].func.isRequired,\n    getSubfields: prop_types_1[\"default\"].func.isRequired,\n    getType: prop_types_1[\"default\"].func.isRequired,\n    getValidator: prop_types_1[\"default\"].func.isRequired\n  },\n  state: {\n    changed: prop_types_1[\"default\"].bool.isRequired,\n    changedMap: prop_types_1[\"default\"].object.isRequired,\n    submitting: prop_types_1[\"default\"].bool.isRequired,\n    label: prop_types_1[\"default\"].bool.isRequired,\n    disabled: prop_types_1[\"default\"].bool.isRequired,\n    placeholder: prop_types_1[\"default\"].bool.isRequired,\n    showInlineError: prop_types_1[\"default\"].bool.isRequired\n  },\n  onChange: prop_types_1[\"default\"].func.isRequired,\n  onSubmit: prop_types_1[\"default\"].func.isRequired,\n  randomId: prop_types_1[\"default\"].func.isRequired\n};\n\nexports.__childContextTypesBuild = function (type) {\n  return isPlainObject_1[\"default\"](type) ? prop_types_1[\"default\"].shape(mapValues_1[\"default\"](type, exports.__childContextTypesBuild)).isRequired : type;\n};\n\nvar BaseForm =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(BaseForm, _super);\n\n  function BaseForm() {\n    var _this = _super.apply(this, arguments) || this;\n\n    _this.state = {\n      bridge: createSchemaBridge_1[\"default\"](_this.props.schema),\n      changed: null,\n      changedMap: {},\n      resetCount: 0,\n      submitting: false\n    };\n    _this.mounted = false;\n    _this.randomId = randomIds_1[\"default\"](_this.props.id);\n    _this.onReset = _this.reset = _this.onReset.bind(_this);\n    _this.onChange = _this.change = _this.onChange.bind(_this);\n    _this.onSubmit = _this.submit = _this.onSubmit.bind(_this); // TODO: It shouldn't be here\n\n    var getModel = _this.getModel.bind(_this);\n\n    _this.getModel = function (mode, model) {\n      if (mode === void 0) {\n        mode = null;\n      }\n\n      if (model === void 0) {\n        model = getModel(mode);\n      }\n\n      return mode !== null && _this.props.modelTransform ? _this.props.modelTransform(mode, model) : model;\n    };\n\n    return _this;\n  }\n\n  BaseForm.prototype.getChildContext = function () {\n    return {\n      uniforms: {\n        name: this.getChildContextName(),\n        error: this.getChildContextError(),\n        model: this.getChildContextModel(),\n        state: this.getChildContextState(),\n        schema: this.getChildContextSchema(),\n        onChange: this.getChildContextOnChange(),\n        onSubmit: this.getChildContextOnSubmit(),\n        randomId: this.randomId\n      }\n    };\n  };\n\n  BaseForm.prototype.componentWillMount = function () {\n    var _this = this;\n\n    this.mounted = true;\n    this.setState(function () {\n      return {};\n    }, function () {\n      return _this.setState(function () {\n        return {\n          changed: false,\n          changedMap: {}\n        };\n      });\n    });\n  };\n\n  BaseForm.prototype.componentWillReceiveProps = function (_a) {\n    var schema = _a.schema;\n\n    if (this.props.schema !== schema) {\n      this.setState(function () {\n        return {\n          bridge: createSchemaBridge_1[\"default\"](schema)\n        };\n      });\n    }\n  };\n\n  BaseForm.prototype.componentWillUnmount = function () {\n    this.mounted = false;\n  };\n\n  BaseForm.prototype.getChildContextName = function () {\n    return [];\n  };\n\n  BaseForm.prototype.getChildContextError = function () {\n    return this.props.error;\n  };\n\n  BaseForm.prototype.getChildContextModel = function () {\n    return this.getModel('form');\n  };\n\n  BaseForm.prototype.getChildContextState = function () {\n    return {\n      changed: !!this.state.changed,\n      changedMap: this.state.changedMap,\n      submitting: this.state.submitting,\n      label: !!this.props.label,\n      disabled: !!this.props.disabled,\n      placeholder: !!this.props.placeholder,\n      showInlineError: !!this.props.showInlineError\n    };\n  };\n\n  BaseForm.prototype.getChildContextSchema = function () {\n    return this.state.bridge;\n  };\n\n  BaseForm.prototype.getChildContextOnChange = function () {\n    return this.onChange;\n  };\n\n  BaseForm.prototype.getChildContextOnSubmit = function () {\n    return this.onSubmit;\n  };\n\n  BaseForm.prototype.getModel = function (mode) {\n    return this.props.model;\n  };\n\n  BaseForm.prototype.getChangedKeys = function (root, valueA, valueB) {\n    return changedKeys_1[\"default\"](root, valueA, valueB);\n  };\n\n  BaseForm.prototype.getNativeFormProps = function () {\n    var props = omit_1[\"default\"](this.props, ['autosave', 'autosaveDelay', 'disabled', 'error', 'label', 'model', 'modelTransform', 'onChange', 'onSubmit', 'onSubmitFailure', 'onSubmitSuccess', 'placeholder', 'schema', 'showInlineError']);\n    return tslib_1.__assign({}, props, {\n      onSubmit: this.onSubmit,\n      key: \"reset-\" + this.state.resetCount\n    });\n  };\n\n  BaseForm.prototype.onChange = function (key, value) {\n    var _this = this; // Do not set `changed` before componentDidMount\n\n\n    if (this.state.changed !== null) {\n      // @ts-ignore\n      this.state.changed = true;\n      this.getChangedKeys(key, value, get_1[\"default\"](this.getModel(), key)).forEach(function (key) {\n        return _this.setState(function (state) {\n          return {\n            changedMap: set_1[\"default\"](cloneDeep_1[\"default\"](state.changedMap), key, {})\n          };\n        });\n      });\n    }\n\n    if (this.props.onChange) {\n      this.props.onChange(key, value);\n    } // Do not call `onSubmit` before componentDidMount\n\n\n    if (this.state.changed !== null && this.props.autosave) {\n      if (this.delayId) {\n        this.delayId = clearTimeout(this.delayId);\n      }\n\n      if (this.props.autosaveDelay > 0) {\n        this.delayId = setTimeout(this.onSubmit, this.props.autosaveDelay);\n      } else {\n        this.onSubmit();\n      }\n    }\n  };\n\n  BaseForm.prototype.__reset = function (state) {\n    return {\n      changed: false,\n      changedMap: {},\n      submitting: false,\n      resetCount: state.resetCount + 1\n    };\n  };\n\n  BaseForm.prototype.onReset = function () {\n    this.setState(this.__reset);\n  };\n\n  BaseForm.prototype.onSubmit = function (event) {\n    var _this = this;\n\n    if (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n\n    var result = this.props.onSubmit && this.props.onSubmit(this.getModel('submit')); // Set the `submitting` state only if onSubmit is async so we don't cause an unnecessary re-render\n\n    var submitting;\n\n    if (result && isFunction_1[\"default\"](result.then)) {\n      this.setState({\n        submitting: true\n      });\n      submitting = result[\"finally\"](function () {\n        return _this.setState({\n          submitting: false\n        });\n      });\n    } else {\n      submitting = Promise.resolve(result);\n    }\n\n    return submitting.then(this.props.onSubmitSuccess, this.props.onSubmitFailure);\n  };\n\n  BaseForm.prototype.render = function () {\n    return react_1[\"default\"].createElement(\"form\", tslib_1.__assign({}, this.getNativeFormProps()));\n  };\n\n  BaseForm.displayName = 'Form';\n  BaseForm.defaultProps = {\n    model: {},\n    label: true,\n    autosave: false,\n    autosaveDelay: 0,\n    noValidate: true\n  };\n  BaseForm.propTypes = {\n    error: prop_types_1[\"default\"].object,\n    model: prop_types_1[\"default\"].object,\n    schema: prop_types_1[\"default\"].any.isRequired,\n    modelTransform: prop_types_1[\"default\"].func,\n    onChange: prop_types_1[\"default\"].func,\n    onSubmit: prop_types_1[\"default\"].func,\n    onSubmitFailure: prop_types_1[\"default\"].func,\n    onSubmitSuccess: prop_types_1[\"default\"].func,\n    label: prop_types_1[\"default\"].bool,\n    disabled: prop_types_1[\"default\"].bool,\n    placeholder: prop_types_1[\"default\"].bool,\n    showInlineError: prop_types_1[\"default\"].bool,\n    autosave: prop_types_1[\"default\"].bool,\n    autosaveDelay: prop_types_1[\"default\"].number\n  };\n  BaseForm.childContextTypes = {\n    uniforms: exports.__childContextTypesBuild(exports.__childContextTypes)\n  };\n  return BaseForm;\n}(react_1.Component);\n\nexports[\"default\"] = BaseForm;","map":{"version":3,"sources":["/Users/connordavidson/Desktop/apollo_blog/apollo-blog/node_modules/uniforms/BaseForm.js"],"names":["exports","__esModule","tslib_1","require","prop_types_1","__importDefault","react_1","__importStar","cloneDeep_1","get_1","isFunction_1","isPlainObject_1","mapValues_1","omit_1","set_1","randomIds_1","createSchemaBridge_1","changedKeys_1","__childContextTypes","name","arrayOf","string","isRequired","error","object","model","schema","getError","func","getErrorMessage","getErrorMessages","getField","getInitialValue","getProps","getSubfields","getType","getValidator","state","changed","bool","changedMap","submitting","label","disabled","placeholder","showInlineError","onChange","onSubmit","randomId","__childContextTypesBuild","type","shape","BaseForm","_super","__extends","_this","apply","arguments","bridge","props","resetCount","mounted","id","onReset","reset","bind","change","submit","getModel","mode","modelTransform","prototype","getChildContext","uniforms","getChildContextName","getChildContextError","getChildContextModel","getChildContextState","getChildContextSchema","getChildContextOnChange","getChildContextOnSubmit","componentWillMount","setState","componentWillReceiveProps","_a","componentWillUnmount","getChangedKeys","root","valueA","valueB","getNativeFormProps","__assign","key","value","forEach","autosave","delayId","clearTimeout","autosaveDelay","setTimeout","__reset","event","preventDefault","stopPropagation","result","then","Promise","resolve","onSubmitSuccess","onSubmitFailure","render","createElement","displayName","defaultProps","noValidate","propTypes","any","number","childContextTypes","Component"],"mappings":"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","sourcesContent":["\"use strict\";\nexports.__esModule = true;\nvar tslib_1 = require(\"tslib\");\nvar prop_types_1 = tslib_1.__importDefault(require(\"prop-types\"));\nvar react_1 = tslib_1.__importStar(require(\"react\"));\nvar cloneDeep_1 = tslib_1.__importDefault(require(\"lodash/cloneDeep\"));\nvar get_1 = tslib_1.__importDefault(require(\"lodash/get\"));\nvar isFunction_1 = tslib_1.__importDefault(require(\"lodash/isFunction\"));\nvar isPlainObject_1 = tslib_1.__importDefault(require(\"lodash/isPlainObject\"));\nvar mapValues_1 = tslib_1.__importDefault(require(\"lodash/mapValues\"));\nvar omit_1 = tslib_1.__importDefault(require(\"lodash/omit\"));\nvar set_1 = tslib_1.__importDefault(require(\"lodash/set\"));\nvar randomIds_1 = tslib_1.__importDefault(require(\"./randomIds\"));\nvar createSchemaBridge_1 = tslib_1.__importDefault(require(\"./createSchemaBridge\"));\nvar changedKeys_1 = tslib_1.__importDefault(require(\"./changedKeys\"));\nexports.__childContextTypes = {\n    name: prop_types_1[\"default\"].arrayOf(prop_types_1[\"default\"].string).isRequired,\n    error: prop_types_1[\"default\"].object,\n    model: prop_types_1[\"default\"].object.isRequired,\n    schema: {\n        getError: prop_types_1[\"default\"].func.isRequired,\n        getErrorMessage: prop_types_1[\"default\"].func.isRequired,\n        getErrorMessages: prop_types_1[\"default\"].func.isRequired,\n        getField: prop_types_1[\"default\"].func.isRequired,\n        getInitialValue: prop_types_1[\"default\"].func.isRequired,\n        getProps: prop_types_1[\"default\"].func.isRequired,\n        getSubfields: prop_types_1[\"default\"].func.isRequired,\n        getType: prop_types_1[\"default\"].func.isRequired,\n        getValidator: prop_types_1[\"default\"].func.isRequired\n    },\n    state: {\n        changed: prop_types_1[\"default\"].bool.isRequired,\n        changedMap: prop_types_1[\"default\"].object.isRequired,\n        submitting: prop_types_1[\"default\"].bool.isRequired,\n        label: prop_types_1[\"default\"].bool.isRequired,\n        disabled: prop_types_1[\"default\"].bool.isRequired,\n        placeholder: prop_types_1[\"default\"].bool.isRequired,\n        showInlineError: prop_types_1[\"default\"].bool.isRequired\n    },\n    onChange: prop_types_1[\"default\"].func.isRequired,\n    onSubmit: prop_types_1[\"default\"].func.isRequired,\n    randomId: prop_types_1[\"default\"].func.isRequired\n};\nexports.__childContextTypesBuild = function (type) {\n    return isPlainObject_1[\"default\"](type)\n        ? prop_types_1[\"default\"].shape(mapValues_1[\"default\"](type, exports.__childContextTypesBuild)).isRequired\n        : type;\n};\nvar BaseForm = /** @class */ (function (_super) {\n    tslib_1.__extends(BaseForm, _super);\n    function BaseForm() {\n        var _this = _super.apply(this, arguments) || this;\n        _this.state = {\n            bridge: createSchemaBridge_1[\"default\"](_this.props.schema),\n            changed: null,\n            changedMap: {},\n            resetCount: 0,\n            submitting: false\n        };\n        _this.mounted = false;\n        _this.randomId = randomIds_1[\"default\"](_this.props.id);\n        _this.onReset = _this.reset = _this.onReset.bind(_this);\n        _this.onChange = _this.change = _this.onChange.bind(_this);\n        _this.onSubmit = _this.submit = _this.onSubmit.bind(_this);\n        // TODO: It shouldn't be here\n        var getModel = _this.getModel.bind(_this);\n        _this.getModel = function (mode, model) {\n            if (mode === void 0) { mode = null; }\n            if (model === void 0) { model = getModel(mode); }\n            return mode !== null && _this.props.modelTransform\n                ? _this.props.modelTransform(mode, model)\n                : model;\n        };\n        return _this;\n    }\n    BaseForm.prototype.getChildContext = function () {\n        return {\n            uniforms: {\n                name: this.getChildContextName(),\n                error: this.getChildContextError(),\n                model: this.getChildContextModel(),\n                state: this.getChildContextState(),\n                schema: this.getChildContextSchema(),\n                onChange: this.getChildContextOnChange(),\n                onSubmit: this.getChildContextOnSubmit(),\n                randomId: this.randomId\n            }\n        };\n    };\n    BaseForm.prototype.componentWillMount = function () {\n        var _this = this;\n        this.mounted = true;\n        this.setState(function () { return ({}); }, function () { return _this.setState(function () { return ({ changed: false, changedMap: {} }); }); });\n    };\n    BaseForm.prototype.componentWillReceiveProps = function (_a) {\n        var schema = _a.schema;\n        if (this.props.schema !== schema) {\n            this.setState(function () { return ({ bridge: createSchemaBridge_1[\"default\"](schema) }); });\n        }\n    };\n    BaseForm.prototype.componentWillUnmount = function () {\n        this.mounted = false;\n    };\n    BaseForm.prototype.getChildContextName = function () {\n        return [];\n    };\n    BaseForm.prototype.getChildContextError = function () {\n        return this.props.error;\n    };\n    BaseForm.prototype.getChildContextModel = function () {\n        return this.getModel('form');\n    };\n    BaseForm.prototype.getChildContextState = function () {\n        return {\n            changed: !!this.state.changed,\n            changedMap: this.state.changedMap,\n            submitting: this.state.submitting,\n            label: !!this.props.label,\n            disabled: !!this.props.disabled,\n            placeholder: !!this.props.placeholder,\n            showInlineError: !!this.props.showInlineError\n        };\n    };\n    BaseForm.prototype.getChildContextSchema = function () {\n        return this.state.bridge;\n    };\n    BaseForm.prototype.getChildContextOnChange = function () {\n        return this.onChange;\n    };\n    BaseForm.prototype.getChildContextOnSubmit = function () {\n        return this.onSubmit;\n    };\n    BaseForm.prototype.getModel = function (mode) {\n        return this.props.model;\n    };\n    BaseForm.prototype.getChangedKeys = function (root, valueA, valueB) {\n        return changedKeys_1[\"default\"](root, valueA, valueB);\n    };\n    BaseForm.prototype.getNativeFormProps = function () {\n        var props = omit_1[\"default\"](this.props, [\n            'autosave',\n            'autosaveDelay',\n            'disabled',\n            'error',\n            'label',\n            'model',\n            'modelTransform',\n            'onChange',\n            'onSubmit',\n            'onSubmitFailure',\n            'onSubmitSuccess',\n            'placeholder',\n            'schema',\n            'showInlineError'\n        ]);\n        return tslib_1.__assign({}, props, { onSubmit: this.onSubmit, key: \"reset-\" + this.state.resetCount });\n    };\n    BaseForm.prototype.onChange = function (key, value) {\n        var _this = this;\n        // Do not set `changed` before componentDidMount\n        if (this.state.changed !== null) {\n            // @ts-ignore\n            this.state.changed = true;\n            this.getChangedKeys(key, value, get_1[\"default\"](this.getModel(), key)).forEach(function (key) {\n                return _this.setState(function (state) { return ({\n                    changedMap: set_1[\"default\"](cloneDeep_1[\"default\"](state.changedMap), key, {})\n                }); });\n            });\n        }\n        if (this.props.onChange) {\n            this.props.onChange(key, value);\n        }\n        // Do not call `onSubmit` before componentDidMount\n        if (this.state.changed !== null && this.props.autosave) {\n            if (this.delayId) {\n                this.delayId = clearTimeout(this.delayId);\n            }\n            if (this.props.autosaveDelay > 0) {\n                this.delayId = setTimeout(this.onSubmit, this.props.autosaveDelay);\n            }\n            else {\n                this.onSubmit();\n            }\n        }\n    };\n    BaseForm.prototype.__reset = function (state) {\n        return {\n            changed: false,\n            changedMap: {},\n            submitting: false,\n            resetCount: state.resetCount + 1\n        };\n    };\n    BaseForm.prototype.onReset = function () {\n        this.setState(this.__reset);\n    };\n    BaseForm.prototype.onSubmit = function (event) {\n        var _this = this;\n        if (event) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n        var result = this.props.onSubmit && this.props.onSubmit(this.getModel('submit'));\n        // Set the `submitting` state only if onSubmit is async so we don't cause an unnecessary re-render\n        var submitting;\n        if (result && isFunction_1[\"default\"](result.then)) {\n            this.setState({ submitting: true });\n            submitting = result[\"finally\"](function () { return _this.setState({ submitting: false }); });\n        }\n        else {\n            submitting = Promise.resolve(result);\n        }\n        return submitting.then(this.props.onSubmitSuccess, this.props.onSubmitFailure);\n    };\n    BaseForm.prototype.render = function () {\n        return react_1[\"default\"].createElement(\"form\", tslib_1.__assign({}, this.getNativeFormProps()));\n    };\n    BaseForm.displayName = 'Form';\n    BaseForm.defaultProps = {\n        model: {},\n        label: true,\n        autosave: false,\n        autosaveDelay: 0,\n        noValidate: true\n    };\n    BaseForm.propTypes = {\n        error: prop_types_1[\"default\"].object,\n        model: prop_types_1[\"default\"].object,\n        schema: prop_types_1[\"default\"].any.isRequired,\n        modelTransform: prop_types_1[\"default\"].func,\n        onChange: prop_types_1[\"default\"].func,\n        onSubmit: prop_types_1[\"default\"].func,\n        onSubmitFailure: prop_types_1[\"default\"].func,\n        onSubmitSuccess: prop_types_1[\"default\"].func,\n        label: prop_types_1[\"default\"].bool,\n        disabled: prop_types_1[\"default\"].bool,\n        placeholder: prop_types_1[\"default\"].bool,\n        showInlineError: prop_types_1[\"default\"].bool,\n        autosave: prop_types_1[\"default\"].bool,\n        autosaveDelay: prop_types_1[\"default\"].number\n    };\n    BaseForm.childContextTypes = {\n        uniforms: exports.__childContextTypesBuild(exports.__childContextTypes)\n    };\n    return BaseForm;\n}(react_1.Component));\nexports[\"default\"] = BaseForm;\n"]},"metadata":{},"sourceType":"script"}