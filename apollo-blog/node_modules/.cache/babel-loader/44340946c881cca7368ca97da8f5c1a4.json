{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\n\nvar tslib_1 = require(\"tslib\");\n\nvar prop_types_1 = tslib_1.__importDefault(require(\"prop-types\"));\n\nvar cloneDeep_1 = tslib_1.__importDefault(require(\"lodash/cloneDeep\"));\n\nvar isEqual_1 = tslib_1.__importDefault(require(\"lodash/isEqual\"));\n\nvar merge_1 = tslib_1.__importDefault(require(\"lodash/merge\"));\n\nvar noop_1 = tslib_1.__importDefault(require(\"lodash/noop\"));\n\nvar omit_1 = tslib_1.__importDefault(require(\"lodash/omit\"));\n\nvar set_1 = tslib_1.__importDefault(require(\"lodash/set\"));\n\nvar BaseForm_1 = tslib_1.__importStar(require(\"./BaseForm\"));\n\nvar childContextTypes = BaseForm_1.__childContextTypesBuild(merge_1[\"default\"]({\n  state: {\n    validating: prop_types_1[\"default\"].bool.isRequired\n  }\n}, BaseForm_1.__childContextTypes));\n\nvar Validated = function (parent) {\n  var _a;\n\n  return _a =\n  /** @class */\n  function (_super) {\n    tslib_1.__extends(class_1, _super);\n\n    function class_1() {\n      var _this = _super.apply(this, arguments) || this; // @ts-ignore\n\n\n      _this.state = tslib_1.__assign({}, _this.state, {\n        error: null,\n        validate: false,\n        validating: false,\n        validator: _this.getChildContextSchema().getValidator(_this.props.validator)\n      });\n      _this.onValidate = _this.validate = _this.onValidate.bind(_this);\n      _this.onValidateModel = _this.validateModel = _this.onValidateModel.bind(_this);\n      return _this;\n    }\n\n    class_1.prototype.getChildContextError = function () {\n      return _super.prototype.getChildContextError.call(this) || this.state.error;\n    };\n\n    class_1.prototype.getChildContextState = function () {\n      return tslib_1.__assign({}, _super.prototype.getChildContextState.call(this), {\n        validating: this.state.validating\n      });\n    };\n\n    class_1.prototype.getNativeFormProps = function () {\n      return omit_1[\"default\"](_super.prototype.getNativeFormProps.call(this), ['onValidate', 'validate', 'validator']);\n    };\n\n    class_1.prototype.componentWillReceiveProps = function (_a) {\n      var _this = this;\n\n      var model = _a.model,\n          schema = _a.schema,\n          validate = _a.validate,\n          validator = _a.validator; // @ts-ignore\n\n      _super.prototype.componentWillReceiveProps.apply(this, arguments);\n\n      if (this.props.schema !== schema || this.props.validator !== validator) {\n        this.setState(function (state) {\n          return {\n            validator: state.bridge.getValidator(validator)\n          };\n        }, function () {\n          if (shouldRevalidate(validate, _this.state.validate)) {\n            _this.onValidate()[\"catch\"](noop_1[\"default\"]);\n          }\n        });\n      } else if (!isEqual_1[\"default\"](this.props.model, model) && shouldRevalidate(validate, this.state.validate)) {\n        this.onValidateModel(model)[\"catch\"](noop_1[\"default\"]);\n      }\n    };\n\n    class_1.prototype.onChange = function (key, value) {\n      if (shouldRevalidate(this.props.validate, this.state.validate)) {\n        this.onValidate(key, value)[\"catch\"](noop_1[\"default\"]);\n      } // FIXME: https://github.com/vazco/uniforms/issues/293\n      // if (this.props.validate === 'onSubmit' && this.state.validate) {\n      //     this.setState(() => ({error: null}));\n      // }\n      // @ts-ignore\n\n\n      _super.prototype.onChange.apply(this, arguments);\n    };\n\n    class_1.prototype.__reset = function (state) {\n      return tslib_1.__assign({}, _super.prototype.__reset.call(this, state), {\n        error: null,\n        validate: false,\n        validating: false\n      });\n    };\n\n    class_1.prototype.onSubmit = function (event) {\n      var _this = this;\n\n      if (event) {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this.setState(function () {\n          return {\n            submitting: true,\n            validate: true\n          };\n        }, function () {\n          _this.onValidate().then(function () {\n            _super.prototype.onSubmit.call(_this).then(resolve, function (error) {\n              _this.setState({\n                error: error\n              });\n\n              reject(error);\n            });\n          }, reject);\n        });\n      });\n      promise[\"catch\"](noop_1[\"default\"]).then(function () {\n        // It can be already unmounted.\n        if (_this.mounted) // If validation fails, or `super.onSubmit` doesn't touch `submitting`, we need to reset it.\n          _this.setState(function (state) {\n            return state.submitting ? {\n              submitting: false\n            } : null;\n          });\n      });\n      return promise;\n    };\n\n    class_1.prototype.onValidate = function (key, value) {\n      var model = this.getChildContextModel();\n\n      if (model && key) {\n        model = set_1[\"default\"](cloneDeep_1[\"default\"](model), key, cloneDeep_1[\"default\"](value));\n      }\n\n      return this.onValidateModel(model);\n    };\n\n    class_1.prototype.onValidateModel = function (model) {\n      var _this = this;\n\n      model = this.getModel('validate', model);\n      var catched = this.props.error || null;\n\n      try {\n        this.state.validator(model);\n      } catch (error) {\n        catched = error;\n      }\n\n      this.setState({\n        validating: true\n      });\n      return new Promise(function (resolve, reject) {\n        _this.props.onValidate(model, catched, function (error) {\n          if (error === void 0) {\n            error = catched;\n          } // Do not copy error from props to state.\n\n\n          _this.setState(function () {\n            return {\n              error: error === _this.props.error ? null : error,\n              validating: false\n            };\n          }, function () {\n            if (error) {\n              reject(error);\n            } else {\n              resolve();\n            }\n          });\n        });\n      });\n    };\n\n    return class_1;\n  }(parent), _a.Validated = Validated, _a.displayName = \"Validated\" + parent.displayName, _a.defaultProps = tslib_1.__assign({}, parent.defaultProps, {\n    onValidate: function (model, error, callback) {\n      callback();\n    },\n    validate: 'onChangeAfterSubmit'\n  }), _a.propTypes = tslib_1.__assign({}, parent.propTypes, {\n    onValidate: prop_types_1[\"default\"].func.isRequired,\n    validator: prop_types_1[\"default\"].any,\n    validate: prop_types_1[\"default\"].oneOf(['onChange', 'onChangeAfterSubmit', 'onSubmit']).isRequired\n  }), _a.childContextTypes = tslib_1.__assign({}, parent.childContextTypes || {}, {\n    uniforms: childContextTypes\n  }), _a;\n};\n\nfunction shouldRevalidate(inProps, inState) {\n  return inProps === 'onChange' || inProps === 'onChangeAfterSubmit' && inState;\n}\n\nexports[\"default\"] = Validated(BaseForm_1[\"default\"]);","map":{"version":3,"sources":["/Users/connordavidson/Desktop/apollo_blog/apollo-blog/node_modules/uniforms/ValidatedForm.js"],"names":["exports","__esModule","tslib_1","require","prop_types_1","__importDefault","cloneDeep_1","isEqual_1","merge_1","noop_1","omit_1","set_1","BaseForm_1","__importStar","childContextTypes","__childContextTypesBuild","state","validating","bool","isRequired","__childContextTypes","Validated","parent","_a","_super","__extends","class_1","_this","apply","arguments","__assign","error","validate","validator","getChildContextSchema","getValidator","props","onValidate","bind","onValidateModel","validateModel","prototype","getChildContextError","call","getChildContextState","getNativeFormProps","componentWillReceiveProps","model","schema","setState","bridge","shouldRevalidate","onChange","key","value","__reset","onSubmit","event","preventDefault","stopPropagation","promise","Promise","resolve","reject","submitting","then","mounted","getChildContextModel","getModel","catched","displayName","defaultProps","callback","propTypes","func","any","oneOf","uniforms","inProps","inState"],"mappings":"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","sourcesContent":["\"use strict\";\nexports.__esModule = true;\nvar tslib_1 = require(\"tslib\");\nvar prop_types_1 = tslib_1.__importDefault(require(\"prop-types\"));\nvar cloneDeep_1 = tslib_1.__importDefault(require(\"lodash/cloneDeep\"));\nvar isEqual_1 = tslib_1.__importDefault(require(\"lodash/isEqual\"));\nvar merge_1 = tslib_1.__importDefault(require(\"lodash/merge\"));\nvar noop_1 = tslib_1.__importDefault(require(\"lodash/noop\"));\nvar omit_1 = tslib_1.__importDefault(require(\"lodash/omit\"));\nvar set_1 = tslib_1.__importDefault(require(\"lodash/set\"));\nvar BaseForm_1 = tslib_1.__importStar(require(\"./BaseForm\"));\nvar childContextTypes = BaseForm_1.__childContextTypesBuild(merge_1[\"default\"]({ state: { validating: prop_types_1[\"default\"].bool.isRequired } }, BaseForm_1.__childContextTypes));\nvar Validated = function (parent) { var _a; return _a = /** @class */ (function (_super) {\n        tslib_1.__extends(class_1, _super);\n        function class_1() {\n            var _this = _super.apply(this, arguments) || this;\n            // @ts-ignore\n            _this.state = tslib_1.__assign({}, _this.state, { error: null, validate: false, validating: false, validator: _this.getChildContextSchema().getValidator(_this.props.validator) });\n            _this.onValidate = _this.validate = _this.onValidate.bind(_this);\n            _this.onValidateModel = _this.validateModel = _this.onValidateModel.bind(_this);\n            return _this;\n        }\n        class_1.prototype.getChildContextError = function () {\n            return _super.prototype.getChildContextError.call(this) || this.state.error;\n        };\n        class_1.prototype.getChildContextState = function () {\n            return tslib_1.__assign({}, _super.prototype.getChildContextState.call(this), { validating: this.state.validating });\n        };\n        class_1.prototype.getNativeFormProps = function () {\n            return omit_1[\"default\"](_super.prototype.getNativeFormProps.call(this), [\n                'onValidate',\n                'validate',\n                'validator'\n            ]);\n        };\n        class_1.prototype.componentWillReceiveProps = function (_a) {\n            var _this = this;\n            var model = _a.model, schema = _a.schema, validate = _a.validate, validator = _a.validator;\n            // @ts-ignore\n            _super.prototype.componentWillReceiveProps.apply(this, arguments);\n            if (this.props.schema !== schema || this.props.validator !== validator) {\n                this.setState(function (state) { return ({ validator: state.bridge.getValidator(validator) }); }, function () {\n                    if (shouldRevalidate(validate, _this.state.validate)) {\n                        _this.onValidate()[\"catch\"](noop_1[\"default\"]);\n                    }\n                });\n            }\n            else if (!isEqual_1[\"default\"](this.props.model, model) &&\n                shouldRevalidate(validate, this.state.validate)) {\n                this.onValidateModel(model)[\"catch\"](noop_1[\"default\"]);\n            }\n        };\n        class_1.prototype.onChange = function (key, value) {\n            if (shouldRevalidate(this.props.validate, this.state.validate)) {\n                this.onValidate(key, value)[\"catch\"](noop_1[\"default\"]);\n            }\n            // FIXME: https://github.com/vazco/uniforms/issues/293\n            // if (this.props.validate === 'onSubmit' && this.state.validate) {\n            //     this.setState(() => ({error: null}));\n            // }\n            // @ts-ignore\n            _super.prototype.onChange.apply(this, arguments);\n        };\n        class_1.prototype.__reset = function (state) {\n            return tslib_1.__assign({}, _super.prototype.__reset.call(this, state), { error: null, validate: false, validating: false });\n        };\n        class_1.prototype.onSubmit = function (event) {\n            var _this = this;\n            if (event) {\n                event.preventDefault();\n                event.stopPropagation();\n            }\n            var promise = new Promise(function (resolve, reject) {\n                _this.setState(function () { return ({ submitting: true, validate: true }); }, function () {\n                    _this.onValidate().then(function () {\n                        _super.prototype.onSubmit.call(_this).then(resolve, function (error) {\n                            _this.setState({ error: error });\n                            reject(error);\n                        });\n                    }, reject);\n                });\n            });\n            promise[\"catch\"](noop_1[\"default\"])\n                .then(function () {\n                // It can be already unmounted.\n                if (_this.mounted)\n                    // If validation fails, or `super.onSubmit` doesn't touch `submitting`, we need to reset it.\n                    _this.setState(function (state) {\n                        return state.submitting ? { submitting: false } : null;\n                    });\n            });\n            return promise;\n        };\n        class_1.prototype.onValidate = function (key, value) {\n            var model = this.getChildContextModel();\n            if (model && key) {\n                model = set_1[\"default\"](cloneDeep_1[\"default\"](model), key, cloneDeep_1[\"default\"](value));\n            }\n            return this.onValidateModel(model);\n        };\n        class_1.prototype.onValidateModel = function (model) {\n            var _this = this;\n            model = this.getModel('validate', model);\n            var catched = this.props.error || null;\n            try {\n                this.state.validator(model);\n            }\n            catch (error) {\n                catched = error;\n            }\n            this.setState({ validating: true });\n            return new Promise(function (resolve, reject) {\n                _this.props.onValidate(model, catched, function (error) {\n                    if (error === void 0) { error = catched; }\n                    // Do not copy error from props to state.\n                    _this.setState(function () { return ({\n                        error: error === _this.props.error ? null : error,\n                        validating: false\n                    }); }, function () {\n                        if (error) {\n                            reject(error);\n                        }\n                        else {\n                            resolve();\n                        }\n                    });\n                });\n            });\n        };\n        return class_1;\n    }(parent)),\n    _a.Validated = Validated,\n    _a.displayName = \"Validated\" + parent.displayName,\n    _a.defaultProps = tslib_1.__assign({}, parent.defaultProps, { onValidate: function (model, error, callback) {\n            callback();\n        }, validate: 'onChangeAfterSubmit' }),\n    _a.propTypes = tslib_1.__assign({}, parent.propTypes, { onValidate: prop_types_1[\"default\"].func.isRequired, validator: prop_types_1[\"default\"].any, validate: prop_types_1[\"default\"].oneOf(['onChange', 'onChangeAfterSubmit', 'onSubmit'])\n            .isRequired }),\n    _a.childContextTypes = tslib_1.__assign({}, (parent.childContextTypes || {}), { uniforms: childContextTypes }),\n    _a; };\nfunction shouldRevalidate(inProps, inState) {\n    return (inProps === 'onChange' || (inProps === 'onChangeAfterSubmit' && inState));\n}\nexports[\"default\"] = Validated(BaseForm_1[\"default\"]);\n"]},"metadata":{},"sourceType":"script"}